<table class="table">
  <tbody>
    <tr>
      <% session[:general_info_demands] = service_delivery_review.demands.kept.map(&:id).join(',') %>
      <td><b><%= ServiceDeliveryReview.human_attribute_name :demands %></b></td>
      <td><%= link_to service_delivery_review.demands.kept.count, demands_list_by_ids_company_demands_path(company, session_demands_key: 'general_info_demands'), target: '_blank' %></td>
    </tr>
    <tr>
      <% session[:discarded_demands] = service_delivery_review.demands.kept.map(&:id).join(',') %>
      <td><b><%= I18n.t('service_delivery_reviews.show.discarded_demands_label') %></b></td>
      <td><%= link_to service_delivery_review.demands.discarded.count, demands_list_by_ids_company_demands_path(company, session_demands_key: 'discarded_demands'), target: '_blank' %></td>
    </tr>
    <tr>
      <td><b><%= t('general.leadtime_p80_label') %></b></td>
      <td><%= I18n.t('general.days_text', count: number_with_precision(service_delivery_review.demands_lead_time_p80 / 1.day, precision: 3)) %></td>
    </tr>
    <tr>
      <% session[:bugs_demands] %>
      <td><b><%= I18n.t('service_delivery_reviews.show.bugs_label') %></b></td>
      <td><%= link_to "#{service_delivery_review.demands.bug.count} (#{number_to_percentage(service_delivery_review.bug_percentage, precision: 2)})", demands_list_by_ids_company_demands_path(company, session_demands_key: 'bugs_demands'), target: '_blank' %></td>
    </tr>
    <% if service_delivery_review.demands.present? %>
      <tr>
        <td><b><%= I18n.t('service_delivery_reviews.show.highest_stage_time') %></b></td>
        <% if service_delivery_review.longest_stage.present? %>
          <td><%= service_delivery_review.longest_stage[:name] %><sup><%= " (#{I18n.t('general.hours_text', count: number_with_precision(service_delivery_review.longest_stage[:time_in_stage] / 1.hour, precision: 2))})" %></sup></td>
        <% else %>
          <td></td>
        <% end %>
      </tr>
      <tr>
        <% session[:overserved_demands] = service_delivery_review.overserved_demands[:value].map(&:id).join(',') %>
        <td><b><%= 'Overserved' %></b></td>
        <td><%= link_to "#{service_delivery_review.overserved_demands[:value].count} (#{number_to_percentage(service_delivery_review.overserved_demands[:share] * 100, precision: 2)})", demands_list_by_ids_company_demands_path(company, session_demands_key: 'overserved_demands'), target: '_blank' %></td>
      </tr>
      <tr>
        <% session[:underserved_demands] = service_delivery_review.underserved_demands[:value].map(&:id).join(',') %>
        <td><b><%= 'Underserved' %></b></td>
        <td><%= link_to "#{service_delivery_review.underserved_demands[:value].count} (#{number_to_percentage(service_delivery_review.underserved_demands[:share] * 100, precision: 2)})", demands_list_by_ids_company_demands_path(company, session_demands_key: 'underserved_demands'), target: '_blank' %></td>
      </tr>
      <tr>
        <% session[:f4p_demands] = service_delivery_review.fit_for_purpose_demands[:value].map(&:id).join(',') %>
        <td><b><%= 'Fit For Purpose' %></b></td>
        <td><%= link_to "#{service_delivery_review.fit_for_purpose_demands[:value].count} (#{number_to_percentage(service_delivery_review.fit_for_purpose_demands[:share] * 100, precision: 2)})", demands_list_by_ids_company_demands_path(company, session_demands_key: 'f4p_demands'), target: '_blank' %></td>
      </tr>
    <% end %>
  </tbody>
</table>