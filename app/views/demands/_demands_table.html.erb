<div class="row">
  <div class="col-xs-6">
    <h2><%= t('demands.index.title') %></h2>
  </div>
</div>

<% if @project.manual? %>
  <div class="row">
    <div class="col-xs-3">
      <%= link_to t('demands.new.title'), new_company_project_project_result_demand_path(@company, @project, @project_result), class: 'btn btn-sm btn-primary bottom-spaced-component' %>
    </div>
  </div>
<% end %>

<table class="table table-index">
  <thead>
    <tr>
      <th><%= t('general.table.actions') %></th>
      <th><%= Project.human_attribute_name :customer_name %></th>
      <th><%= Project.human_attribute_name :product_name %></th>
      <th><%= Demand.human_attribute_name :project %></th>
      <th><%= Demand.human_attribute_name :demand_id %></th>
      <th><%= Demand.human_attribute_name :demand_type %></th>
      <th><%= Demand.human_attribute_name :class_of_service %></th>
      <th><%= Demand.human_attribute_name :created_date %></th>
      <th><%= Demand.human_attribute_name :commitment_date %></th>
      <th><%= Demand.human_attribute_name :end_date %></th>
      <th><%= Demand.human_attribute_name :leadtime %></th>
      <th><%= Demand.human_attribute_name :assignees_count %></th>
      <th><%= t('demands.index.total_working_time') %></th>
      <th><%= t('demands.index.blocked_working_time') %></th>
      <th><%= Demand.human_attribute_name :effort %></th>
      <th><%= Demand.human_attribute_name(:url).upcase %></th>
      <th><%= t('general.table.actions') %></th>
    </tr>
  </thead>
  <tbody>
    <% demands_list.each do |demand| %>
      <tr>
        <td>
          <%= link_to edit_company_project_project_result_demand_path(@company, @project, @project_result, demand) do %>
            <i class="fas fa-edit"></i>
          <% end %>
          <%= link_to company_project_project_result_demand_path(@company, @project, @project_result, demand), method: :delete do %>
            <i class="fa fa-times" aria-hidden="true"></i>
          <% end %>
        </td>
        <td><%= link_to @project.customer_name, company_customer_path(@company, @project.customer) %></td>
        <td>
          <% if @project.product.present? %>
            <%= link_to @project.product_name, company_product_path(@company, @project.product) %>
          <% end %>
        </td>
        <td><%= link_to @project.name, company_project_path(@company, @project) %></td>
        <td><%= link_to demand.demand_id, company_project_project_result_demand_path(@company, @project, @project_result, demand) %></td>
        <td><%= t("activerecord.attributes.demand.enums.demand_type.#{demand.demand_type}") %></td>
        <td><%= t("activerecord.attributes.demand.enums.class_of_service.#{demand.class_of_service}") %></td>
        <td><%= l(demand.created_date, format: :short) if demand.created_date.present? %></td>
        <td><%= l(demand.commitment_date, format: :short) if demand.commitment_date.present? %></td>
        <td><%= l(demand.end_date, format: :short) if demand.end_date.present? %></td>
        <td><%= time_ago_in_words(demand.leadtime.seconds.ago) if demand.leadtime.present? %></td>
        <td><%= demand.assignees_count %></td>
        <td><%= number_with_precision(demand.total_working_time, precision: 2) %></td>
        <td><%= number_with_precision(demand.blocked_working_time, precision: 2) %></td>
        <td><%= number_with_precision(demand.effort, precision: 2) %></td>
        <td><%= link_to demand.url, demand.url %></td>
        <td>
          <%= link_to company_project_project_result_demand_path(@company, @project, @project_result, demand), method: :delete do %>
            <i class="fa fa-times" aria-hidden="true"></i>
          <% end %>
          <%= link_to edit_company_project_project_result_demand_path(@company, @project, @project_result, demand) do %>
            <i class="fas fa-edit"></i>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
