<div class="row">
  <div class="col-xs-12">
    <ul class="breadcrumb">
      <li><%= link_to I18n.t('general.home.title'), root_path %></li>
      <li><%= link_to @company.abbreviation&.upcase, company_path(@company) %></li>
      <li><%= Task.model_name.human(count: 2) %></li>
    </ul>
  </div>
</div>

<div id="dashboard-controls">
  <div class="row">
    <div class="col-xs-12 center">
      <div class="tab">
        <%= link_to I18n.t('general.list'), search_company_tasks_path(@company, tasks_search: params['tasks_search']), class: 'btn btn-default', method: :post %>
        <%= link_to I18n.t('general.tabs.charts'), '#', class: 'btn btn-default active' %>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-xs-12">
    <h3><%= I18n.t('tasks.index.count', count: @tasks.count) %></h3>
  </div>
</div>

<div class="row">
  <div class="col-xs-6">
    <% if @task_completion_control_chart_data.present? %>
      <div id="tasks-completion-scatter"
           class="flow-chart"
           data-xcategories='<%= @task_completion_control_chart_data.map { |control_chart| control_chart[:id] }.to_json %>'
           data-series='<%= [{ name: I18n.t('tasks.charts.completion_time'), color: 'rgb(51, 51, 255)', data: @task_completion_control_chart_data.map { |scatter_chart| { y: scatter_chart[:completion_time] / 1.day, url: scatter_chart[:item_url] } } }].to_json %>'
           data-title='<%= I18n.t('tasks.charts.completion_control_chart.title') %>'
           data-prefix=''
           data-tooltipsuffix='<%= I18n.t('tasks.charts.completion_control_chart.ylabel') %>'
           data-percentile95='<%= Stats::StatisticsService.instance.percentile(95, @completion_times) / 1.day %>'
           data-percentile80='<%= Stats::StatisticsService.instance.percentile(95, @completion_times) / 1.day %>'
           data-percentile65='<%= Stats::StatisticsService.instance.percentile(95, @completion_times) / 1.day %>'>
      </div>
    <% else %>
      <% render 'layouts/no_data', missing_data: I18n.t('general.data') %>
    <% end %>
  </div>
</div>

<% content_for :javascript do %>
  <%= javascript_include_tag 'charts/scatter' %>

  <%= javascript_include_tag 'tasks/charts' %>
<% end %>
