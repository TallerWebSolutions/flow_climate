dist: trusty
sudo: required
env:
  global:
  - PGPORT=5433
  - CC_TEST_REPORTER_ID=70ab5420793b8b581d83df1dc8dcc49ca7c48d3deb51c9f9a8c2a5e0899c8f71
language: ruby
cache: bundler
rvm:
- 2.5.3
before_install: gem install bundler
services:
- postgresql
addons:
  postgresql: '10'
  apt:
    packages:
    - postgresql-10
    - postgresql-client-10
before_script:
- cp config/database.yml.travis config/database.yml
- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64
  > ./cc-test-reporter
- chmod +x ./cc-test-reporter
- "./cc-test-reporter before-build"
script:
- RAILS_ENV=test bundle exec rake db:create --trace
- RAILS_ENV=test bundle exec rake db:migrate --trace
- bundle exec rake db:test:prepare
- bundle exec rspec spec/
- bundle exec rubocop -DR
- bundle exec rake assets:precompile
- git add public/assets
- git commit -am 'assets precompiled'
after_script:
- "./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT"
deploy:
  provider: heroku
  api_key:
    secure: KsdlwzIXCfoEbz2eX65G2sQiA3MN8WPBZ5vTdlizk8pOsj4uGfW3VuEiKFctgk31E11WzEi9rw4QRAuaBnRT9nK9MisRPOrL4HrNYdHWPIrd9iMaEgnbTgoDV+uNs2uU432FFrGPQraBYLZIcysW557hoSPwLQ1GtTdonwy/WECG9AA1SfpJlI4sfQuhh2qvrpCdmdqvWWSUy881bxn+sESc9INBC6PEKZSklowjOd3ztEVPdes/GC1wwScraSo6IpW6dyl8f6gYKIvIPX/Mc6LbAcDBER5G7zrkJj2riH9bq6JCn5OwpI2c5EGMZwEsykrrvgRoyOp0TqWQM6RA2DgVEmeTOJXJMxIgQqJmRQGo6bYyGZ04fxx65j0QMrxI1FO5iI8qDfi9+629SIct940aybyFLYOfPp/hAjulYz2SWfcrmQuZfdclHjED29KBKnq14fxdUZmEOsvUKsRABOODLhyuL+0iTA4E3PKNfV0E7m9TfI+rEaq40lVYiP5XIsuAk1jLjCHw/R9nIImPkbhFuNQBP3CKmj28wIuW4QG+2TJHVCotnxETQZfbrQi0hObg6jZi95NSR5V2gb+yR3taZCgT/LnFjHmyAo8K+6Ahf+zFwDbX1OFHy+wKw6UvW/3pEdsevIPss/vStkHXX37c3feOFLt55TwZY2oPato=
  run: rake db:migrate
  app:
    develop: flowclimatestaging
    master: flowclimateapp
  on:
    repo: TallerWebSolutions/flow_climate
