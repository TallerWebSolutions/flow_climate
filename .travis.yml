dist: trusty
sudo: required
env:
  global:
  - PGPORT=5433
  - CC_TEST_REPORTER_ID=70ab5420793b8b581d83df1dc8dcc49ca7c48d3deb51c9f9a8c2a5e0899c8f71
language: ruby
cache: bundler
rvm:
- 2.5.1
before_install: gem install bundler
services:
- postgresql
addons:
  postgresql: '10'
  apt:
    packages:
    - postgresql-10
    - postgresql-client-10
before_script:
- cp config/database.yml.travis config/database.yml
- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64
  > ./cc-test-reporter
- chmod +x ./cc-test-reporter
- "./cc-test-reporter before-build"
script:
- RAILS_ENV=test bundle exec rake db:create --trace
- RAILS_ENV=test bundle exec rake db:migrate --trace
- bundle exec rake db:test:prepare
- bundle exec rspec spec/
- bundle exec rubocop -DR
- bundle exec rake assets:precompile
- git add public/assets
- git commit -am 'assets precompiled'
after_script:
- "./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT"
deploy:
  provider: heroku
  api_key:
    secure: XmEw0fMwM1FyegG/85OU8i+tNpQbzubqH7QLepCSyLNTJeMjeiRXgBALJZX0uYIUGsMD9ZNHxRbJa0sdA/U2Om6un3sTi31Uw6ZEXhwFviNv1deAidXPMiTIikS8Lg5d93olkdiJTUcgQMw7SqQc+EpZ79AjS2M70hT+xesAADTXe+GAgd8AoNsUoCoGEPgwi4S/rHj4mRoiVyCG+NG46yZG6wBkNzq5jKzssD+E9fRCvi3SlVbaukGPmh3i/cwZHht7AwBVibeo4w3pi/pkel3eCfnPOPzrjdi7WVCh86PCQdXkpXTdpYraVNXwhbaVc4JrIhipPjGKXJh+mdP5pyLZtwl1+g6a1esyJWlXQTkZpvR69IP9iQL+ad1NF7cepFljO7/m33EWENNki16x3cV8k9e34J7bePfOIGxT+xOHnvTFRdRVciG05juVE8wBGVFKEby4+mibSMnRnZVjMVyvvr14f5TwA81PBKp0PFcQVeRJCDay9MbD4VHVzrYsq0MZkF6k3vKYECIVlZ1SLout4lVQmyWDQHgr/JlvdLOhZU+UexSkxgh0rvWhJtOBe9Ae3bjuyilqZaWgtTBa4uYG63PoWERbOxHqbgn+NwjT5l9LW6Dd875ux1GzE6ZwaF3q+BpNLqj1c5FvRM+zZzXncJt2/xLSxwbwpcRbNAI=
  run: rake db:migrate
  app:
    develop: flowclimatestaging
    master: flowclimateapp
  on:
    repo: TallerWebSolutions/flow_climate
